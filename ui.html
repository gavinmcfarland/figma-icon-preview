<h2>Rectangle Creator</h2>
<p>Count: <input id="count" value="5"></p>
<p>Example: <input id="example"></p>
<div id="canvasPlaceholder"></div>
<div id="canvasPlaceholder2"></div>
<svg id="mySVG" xmlns="http://www.w3.org/2000/svg" version="1.1">
  <rect width="150" height="150" fill="rgb(0, 255, 0)" stroke-width="1" stroke="rgb(0, 0, 0)"/>
</svg>
<button id="create">Create</button>
<button id="cancel">Cancel</button>
<button id="test" onmessage>test</button>

<script>

async function decode(canvas, ctx, bytes, scale = 1) {
  const url = URL.createObjectURL(new Blob([bytes]))
  
  const image = await new Promise((resolve, reject) => {
    const img = new Image()
    img.onload = () => resolve(img)
    img.onerror = () => reject()
    img.src = url
  })

  canvas.width = image.width
  canvas.height = image.height
  canvas.style.width = ((canvas.width * scale) / 8) + "px"
  canvas.style.height = ((canvas.width * scale) / 8) + "px"
  ctx.drawImage(image, 0, 0)
  const imageData = ctx.getImageData(0, 0, image.width, image.height)
  return imageData
}

const example = document.querySelector('#example');
const canvasPlaceholder = document.querySelector('#canvasPlaceholder');
const canvas = document.createElement('canvas')
canvasPlaceholder.appendChild(canvas)
const ctx = canvas.getContext('2d')

const canvasPlaceholder2 = document.querySelector('#canvasPlaceholder2');
const canvas2 = document.createElement('canvas')
canvasPlaceholder2.appendChild(canvas2)
const ctx2 = canvas2.getContext('2d')


document.getElementById('create').onclick = () => {
  const textbox = document.getElementById('count');
  const count = parseInt(textbox.value, 10);
  parent.postMessage({ pluginMessage: { type: 'create-rectangles', count } }, '*')
}


  window.onmessage = async (event) => {
    const bytes = event.data.pluginMessage
    const imageData = await decode(canvas, ctx, bytes)
    const imageData2 = await decode(canvas2, ctx2, bytes, 2)
  }



document.getElementById('cancel').onclick = () => {
  parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*')
}

</script>
