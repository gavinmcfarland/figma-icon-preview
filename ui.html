<h2>Rectangle Creator</h2>
<p>Count: <input id="count" value="5"></p>
<p>Example: <input id="example"></p>
<div id="canvasPlaceholder"></div>
<button id="create">Create</button>
<button id="cancel">Cancel</button>
<button id="test" onmessage>test</button>
<script>

async function decode(canvas, ctx, bytes) {
  const url = URL.createObjectURL(new Blob([bytes]))
  const image = await new Promise((resolve, reject) => {
    const img = new Image()
    img.onload = () => resolve(img)
    img.onerror = () => reject()
    img.src = url
  })
  canvas.width = image.width
  canvas.height = image.height
  ctx.drawImage(image, 0, 0)
  const imageData = ctx.getImageData(0, 0, image.width, image.height)
  return imageData
}

const example = document.querySelector('#example');
const canvasPlaceholder = document.querySelector('#canvasPlaceholder');
const canvas = document.createElement('canvas')
canvasPlaceholder.appendChild(canvas)
const ctx = canvas.getContext('2d')

document.getElementById('create').onclick = () => {
  const textbox = document.getElementById('count');
  const count = parseInt(textbox.value, 10);
  parent.postMessage({ pluginMessage: { type: 'create-rectangles', count } }, '*')
}


  window.onmessage = async (event) => {
    const bytes = event.data.pluginMessage
    const imageData = await decode(canvas, ctx, bytes)
    const pixels = imageData.data
    canvas.data = imageData.data
    console.log(pixels)
  }



document.getElementById('cancel').onclick = () => {
  parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*')
}

</script>
