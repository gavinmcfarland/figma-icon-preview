"use strict";async function e(e){return await figma.clientStorage.getAsync(e)}function i(e,i){return figma.clientStorage.setAsync(e,i)}const n=[];function t(e){var i=(e=Math.floor(255*e)).toString(16);return 1==i.length?"0"+i:i}figma.ui.onmessage=e=>{for(let i of n)e.action===i.action&&i.callback(e.data)},console.clear();var a,r,o,c,l,s=[{size:16,group:"General"},{size:24,group:"General"},{size:32,group:"General"},{size:48,group:"General"},{size:64,group:"General"},{size:96,group:"General"},{size:128,group:"General"},{size:20,group:"iOS",label:"Notification"},{size:29,group:"iOS",label:"Settings"},{size:40,group:"iOS",label:"Spotlight"},{size:60,group:"iOS",label:"iPhone"},{size:76,group:"iOS",label:"iPad"},{size:83.5,group:"iOS",label:"iPad Pro"},{size:16,group:"Android",label:"Small Contextual"},{size:22,group:"Android",label:"Notification"},{size:24,group:"Android",label:"System"},{size:48,group:"Android",label:"Product"}];function g(e){return"FRAME"===e.type||"COMPONENT"===e.type||"INSTANCE"===e.type}function u(e){return e.height<=512&&e.width<=512}async function f(e){var i;return e.children&&e.children.length>0&&e.visible&&function(e){for(var i=e.children.length,n=0,t=0;t<e.children.length;t++)e.children[t].visible||n++;if(i!==n)return!0}(e)&&(i=await e.exportAsync({format:"SVG"})),i}async function m(e){return await f(e)}function h(e){return b(e)?e:e.parent?h(e.parent):void 0}async function p(e){if(e)return await f(e,e.width)}function d(){var e=function(e){if(e){let{r:i,g:n,b:a}=e;return"#"+t(i)+t(n)+t(a)}}(figma.currentPage.backgrounds[0].color);return"#e5e5e5"!==e?e:"#ffffff"}function P(e){if(e.width===e.height)return e}function b(e){if(e&&P(e)&&u(e)&&g(e))return e}function v(e){a=e||figma.currentPage.selection[0]}function z(e){p(e).then((i=>{l||(v(e),figma.ui.postMessage({currentIconThumbnail:i,thumbnails:s}))}))}async function S(){var i=await e("uiSize")||{width:328,height:294},n=await e("scrollPos")||{top:0,left:0};o=c=i,1===figma.currentPage.selection.length?u(figma.currentPage.selection[0])?g(figma.currentPage.selection[0])?P(figma.currentPage.selection[0])?(figma.showUI(__html__,i),v(),a.setRelaunchData({previewIcon:"Preview the currently selected icon"}),p(figma.currentPage.selection[0]).then((e=>{m(a).then((i=>{var t;figma.currentPage.selection[0].id!==a.id&&(t=e),figma.ui.postMessage({thumbnails:s,currentIconThumbnail:i,selectedIconThumbnail:t,canvasColor:d(),scrollPos:n})}))}))):figma.closePlugin("Selection must be square"):figma.closePlugin("Selection must be a frame, group, component or instance"):figma.closePlugin("Icon must be 256px or smaller"):0===figma.currentPage.selection.length?figma.closePlugin("Select an icon"):figma.closePlugin("Select one icon at a time"),figma.on("selectionchange",(()=>{if(1===figma.currentPage.selection.length)if(function(e,i){if(i&&e&&("FRAME"===i||"GROUP"===i||"INSTANCE"===i||"COMPONENT"===i))return i.findOne((i=>i.id===e.id))}(figma.currentPage.selection[0],a))figma.ui.postMessage({selectedIconThumbnail:void 0});else if(b(figma.currentPage.selection[0]))r=figma.currentPage.selection[0],1===figma.currentPage.selection.length&&b(figma.currentPage.selection[0])&&z(r);else{var e=h(figma.currentPage.selection[0]);e&&z(e)}else figma.ui.postMessage({selectedIconThumbnail:void 0})})),setInterval((()=>{a&&figma.getNodeById(a.id)?m(a).then((e=>{figma.ui.postMessage({thumbnails:s,currentIconThumbnail:e,canvasColor:d()})})):figma.ui.postMessage({currentIconThumnail:void 0,thumbnails:s,canvasColor:d()})}),375)}r=figma.currentPage.selection[0],S(),"previewIcon"===figma.command&&S(),figma.ui.onmessage=e=>{if("set-preview"===e.type&&0===figma.currentPage.selection.length&&z(figma.currentPage.selection[0]),"lock-preview"===e.type){if(!e.locked&&1===figma.currentPage.selection.length){var i=h(figma.currentPage.selection[0]);i&&z(i)}l=e.locked}"resize"===e.type&&(figma.ui.resize(e.size.width,e.size.height),c=e.size),"scroll-position"===e.type&&(o=e.pos)},figma.on("close",(()=>{i("uiSize",c),i("scrollPos",o)}));
